<?php
 use Phinx\Migration\AbstractMigration; class AddonsSdAffiliateAndReferralAddDefaultPlanField extends AbstractMigration { protected $addon_id = 'sd_affiliate'; public function up() { $options = $this->adapter->getOptions(); $this->prefix = $options['prefix']; $addon = $this->fetchRow( "SELECT addon FROM {$this->prefix}addons" . " WHERE addon = '{$this->addon_id}'" ); if (empty($addon)) { return; } if ($this->hasTable("{$this->prefix}affiliate_plans")) { $table = $this->table("{$this->prefix}affiliate_plans"); if (!$table->hasColumn('is_default')) { $table->addColumn( 'is_default', 'string', ['limit' => 1, 'signed' => false, 'null' => false, 'default' => 'N', 'after' => 'plan_type'] )->update(); } $table->save(); } } public function down() { } } 