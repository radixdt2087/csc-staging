<?php
 use Tygh\Registry; if (!defined('BOOTSTRAP')) { die('Access denied'); } if ($_SERVER['REQUEST_METHOD'] == 'POST') { $dispatch = ''; if ($mode == 'api_check') { if (empty($_REQUEST['merchantId']) || empty($_REQUEST['awsKeyId']) || empty($_REQUEST['awsSecretKey']) || empty($_REQUEST['marketPlaceId'])) { return array(CONTROLLER_STATUS_REDIRECT, Registry::get('config.current_url')); } $dispatch = 'addons.manage'; $_auth = array( 'merchantId' => $_REQUEST['merchantId'], 'keyId' => $_REQUEST['awsKeyId'], 'secretKey' => $_REQUEST['awsSecretKey'], 'marketplaceId' => $_REQUEST['marketPlaceId'], ); $amazon_config = fn_get_amazon_config($_REQUEST['marketPlaceRegion'], $_auth); $amz = new \AmazonParticipationList($amazon_config); $response = $amz->fetchParticipationList(); $response = json_decode(json_encode(simplexml_load_string($response['body'])), true); if (isset($response['ListMarketplaceParticipationsResult']['ListParticipations'])) { fn_set_notification('N', 'Response Request ID:', $response['ResponseMetadata']['RequestId']); } elseif (isset($response['Error'])) { fn_set_notification('E', $response['Error']['Code'], $response['Error']['Message']); } } return array(CONTROLLER_STATUS_OK, $dispatch); } 